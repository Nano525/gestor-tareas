<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>√Årbol Binario - Gestor de Tareas</title>
    <link rel="stylesheet" th:href="@{/css/styles.css?v=3.0}">
    <style>
        .sidebar { background: #1a202c !important; }
        body { background: #f0f4f8 !important; }
    </style>
</head>
<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2>üìã Gestor Tareas</h2>
                <div class="user-info">
                    <span>üë§ <strong th:text="${usuarioNombre}">Usuario</strong></span>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <a href="/dashboard" class="nav-item">
                    <span>üè†</span> <span>Dashboard</span>
                </a>
                <a href="/agregar-tarea" class="nav-item">
                    <span>‚ûï</span> <span>Agregar Tarea</span>
                </a>
                <a href="/pila" class="nav-item">
                    <span>üìö</span> <span>Pila (Historial)</span>
                </a>
                <a href="/cola" class="nav-item">
                    <span>üîÑ</span> <span>Cola (FIFO)</span>
                </a>
                <a href="/arbol" class="nav-item active">
                    <span>üå≥</span> <span>√Årbol Binario</span>
                </a>
            </nav>
            
            <div class="sidebar-footer">
                <a href="/logout" class="logout-btn">üö™ Cerrar Sesi√≥n</a>
            </div>
        </aside>

        <main class="main-content">
            <div class="content-wrapper">
                <div class="page-header">
                    <h1>üå≥ √Årbol Binario - Organizaci√≥n por Prioridad</h1>
                    <p>Estructura que clasifica y organiza elementos seg√∫n su nivel de prioridad (ALTA > MEDIA > BAJA)</p>
                </div>

                <div class="section">
                    <div class="info-box">
                        <strong>üìñ ¬øQu√© es un √Årbol Binario?</strong>
                        <p>Un √°rbol binario es una estructura de datos donde cada nodo tiene como m√°ximo dos hijos. Se utiliza para organizar datos de manera jer√°rquica. En este caso, organizamos las tareas por prioridad.</p>
                    </div>

                    <div class="actions-buttons">
                        <button onclick="cargarArbolInorden()">üîÑ Ver Inorden</button>
                        <button onclick="cargarArbolPreorden()">üîÑ Ver Preorden</button>
                        <button onclick="cargarArbolPostorden()">üîÑ Ver Postorden</button>
                        <button onclick="cargarArbolTodas()">üìã Ver Todas</button>
                    </div>

                    <h3>Tareas en el √Årbol</h3>
                    <div class="tareas-list" id="arbolTareas" style="max-height: 500px;">
                        <div class="empty-message">Cargando √°rbol...</div>
                    </div>
                </div>

                <script>
                    const API_BASE = '/api';

                    window.onload = function() {
                        cargarArbolTodas();
                    };

                    async function cargarArbolInorden() {
                        try {
                            const response = await fetch(`${API_BASE}/arbol/inorden`);
                            const data = await response.json();
                            const tareas = Array.isArray(data) ? data : Object.values(data);
                            mostrarArbol(tareas, 'Inorden');
                        } catch (error) {
                            console.error('Error al cargar √°rbol inorden:', error);
                        }
                    }

                    async function cargarArbolPreorden() {
                        try {
                            const response = await fetch(`${API_BASE}/arbol/preorden`);
                            const data = await response.json();
                            const tareas = Array.isArray(data) ? data : Object.values(data);
                            mostrarArbol(tareas, 'Preorden');
                        } catch (error) {
                            console.error('Error al cargar √°rbol preorden:', error);
                        }
                    }

                    async function cargarArbolPostorden() {
                        try {
                            const response = await fetch(`${API_BASE}/arbol/postorden`);
                            const data = await response.json();
                            const tareas = Array.isArray(data) ? data : Object.values(data);
                            mostrarArbol(tareas, 'Postorden');
                        } catch (error) {
                            console.error('Error al cargar √°rbol postorden:', error);
                        }
                    }

                    async function cargarArbolTodas() {
                        try {
                            const response = await fetch(`${API_BASE}/arbol/tareas`);
                            const data = await response.json();
                            const tareas = Array.isArray(data) ? data : Object.values(data);
                            mostrarArbol(tareas, 'Todas (Inorden)');
                        } catch (error) {
                            console.error('Error al cargar √°rbol:', error);
                        }
                    }

                    function mostrarArbol(tareas, tipoRecorrido) {
                        const container = document.getElementById('arbolTareas');
                        const tareasArray = Array.isArray(tareas) ? tareas : Object.values(tareas);

                        if (!tareasArray || tareasArray.length === 0) {
                            container.innerHTML = '<div class="empty-message">No hay tareas en el √°rbol. Agrega tareas para verlas organizadas por prioridad.</div>';
                            return;
                        }

                        container.innerHTML = `
                            <div style="margin-bottom: 10px; font-weight: bold; color: #667eea; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                                Recorrido: ${tipoRecorrido} (${tareasArray.length} tareas)
                            </div>
                            ${tareasArray.map((tarea, index) => `
                                <div class="tarea-item ${tarea.estado === 'COMPLETADA' ? 'completada' : tarea.estado === 'EN_PROGRESO' ? 'en-progreso' : ''}">
                                    <div class="tarea-header">
                                        <div class="tarea-titulo">#${index + 1} - ${tarea.titulo}</div>
                                        <span class="tarea-prioridad prioridad-${tarea.prioridad.toLowerCase()}">
                                            ${tarea.prioridad}
                                        </span>
                                    </div>
                                    <div style="color: #666; margin-bottom: 5px;">${tarea.descripcion || 'Sin descripci√≥n'}</div>
                                    <span class="tarea-estado estado-${tarea.estado.toLowerCase().replace('_', '-')}">
                                        ${tarea.estado.replace('_', ' ')}
                                    </span>
                                </div>
                            `).join('')}
                        `;
                    }
                </script>
            </div>
        </main>
    </div>
</body>
</html>
